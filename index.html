<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>График рабочих смен</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			padding: 10px;
		}

		.container {
			max-width: 1400px;
			margin: 0 auto;
			background: white;
			border-radius: 20px;
			padding: 40px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			overflow-x: hidden;
		}

		h3 {
			color: #2d3748;
			font-size: 1.4em;
			margin-bottom: 15px;
			font-weight: 600;
		}

		.block_container {
			margin-top: 35px;
			padding: 25px;
			background: #f7fafc;
			border-radius: 15px;
			border: 2px solid #e2e8f0;
		}

		.block_container:first-child {
			margin-top: 0;
		}

		.inputs_container {
			margin-top: 15px;
			display: flex;
			gap: 15px;
			flex-wrap: wrap;
			align-items: center;
		}

		.input {
			padding: 12px 16px;
			border: 2px solid #cbd5e0;
			border-radius: 10px;
			font-size: 15px;
			transition: all 0.3s ease;
			background: white;
		}

		.input:hover {
			border-color: #667eea;
		}

		.input:focus {
			outline: none;
			border-color: #667eea;
			box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
		}

		select.input {
			cursor: pointer;
			min-width: 180px;
		}

		#target_date_type {
			background: #667eea;
			color: white;
			font-weight: 600;
			padding: 12px 20px;
			border-radius: 10px;
			display: inline-block;
		}

		.calendar {
			margin-top: 20px;
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
			gap: 20px;
			width: 100%;
		}

		table.month {
			border-collapse: collapse;
			text-align: center;
			width: 100%;
			background: white;
			border-radius: 12px;
			overflow: hidden;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
			table-layout: fixed;
		}

		table.month thead {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		table.month thead th {
			padding: 12px 4px;
			font-weight: 600;
			font-size: 14px;
			width: 14.28%;
		}

		table.month thead tr:first-child th {
			font-size: 16px;
			padding: 15px;
		}

		table.month td {
			padding: 8px 2px;
			font-weight: 500;
			transition: all 0.2s ease;
			border: 1px solid rgba(0, 0, 0, 0.05);
			font-size: 14px;
			width: 14.28%;
		}

		table.month td:hover {
			transform: scale(1.1);
			z-index: 10;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
		}

		.first-shift {
			background: #FF4900;
			color: white;
		}

		.second-shift {
			background: #E40045;
			color: white;
		}

		.after-second-shift {
			background: #00AF64;
			color: white;
		}

		.weekend {
			background: #67E300;
			color: white;
		}

		.color_map {
			margin-top: 20px;
			padding: 20px !important;
			background: white !important;
			border: 2px solid #e2e8f0;
			border-radius: 12px;
			display: inline-block;
		}

		.color_map strong {
			display: block;
			margin-bottom: 12px;
			color: #2d3748;
			font-size: 16px;
		}

		.color_map > div {
			display: flex;
			gap: 10px;
			flex-wrap: wrap;
		}

		.color_map_item {
			padding: 10px 18px !important;
			border-radius: 8px;
			font-weight: 600;
			font-size: 14px;
			color: white;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
			transition: all 0.2s ease;
		}

		.color_map_item:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
		}

		.color_map_item:first-child {
			margin-top: 0;
		}

		.current-day {
			font-weight: 900;
			position: relative;
			box-shadow: inset 0 0 0 3px rgba(255, 255, 255, 0.8) !important;
			transform: scale(1.05);
		}

		.current-day::after {
			content: '●';
			position: absolute;
			top: 2px;
			right: 4px;
			font-size: 10px;
			color: white;
			text-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
		}

		@media (max-width: 768px) {
			body {
				padding: 5px;
			}

			.container {
				padding: 15px;
				border-radius: 15px;
			}

			.block_container {
				padding: 15px;
				margin-top: 20px;
			}

			.calendar {
				grid-template-columns: 1fr;
				gap: 15px;
			}

			.inputs_container {
				flex-direction: column;
				align-items: stretch;
			}

			.input {
				width: 100%;
			}

			h3 {
				font-size: 1.1em;
			}

			table.month thead th {
				padding: 10px 2px;
				font-size: 12px;
			}

			table.month thead tr:first-child th {
				font-size: 14px;
				padding: 12px 8px;
			}

			table.month td {
				padding: 8px 1px;
				font-size: 13px;
			}

			table.month td:hover {
				transform: scale(1.05);
			}

			.color_map {
				width: 100%;
			}

			.color_map > div {
				flex-direction: column;
			}

			.color_map_item {
				width: 100%;
				text-align: center;
			}
		}
	</style>
</head>
<body>
	<main class="container">
		<div class="block_container">
			<h3>Опорная дата (известная смена в прошлом)</h3>
			<div class="inputs_container">
				<input class="input" type="date" name="start_date">
				<select class="input" name="date_type">
				</select>
			</div>
		</div>
		<div class="block_container">
			<h3>Узнать смену для конкретной даты</h3>
			<div class="inputs_container">
				<input class="input" type="date" name="target_date">
				<span class="input" id="target_date_type"></span>
			</div>
		</div>
		<div class="block_container">
			<h3>Календарь рабочих смен</h3>
			<div>
				Построить календарь с <input class="input" type="month" name="start_calendar_date"> 
				по <input class="input" type="month" name="end_calendar_date">
			</div>
			<div class="block_container color_map" id="color_map">
				<strong>Обозначения</strong>
			</div>
			<div class="calendar" id="calendar">
				
			</div>
		</div>
	</main>

	<script type="text/javascript">
		function getInputValue(name) {
			return document.getElementsByName(name)[0].value
		}

		function setInputValue(name, value) {
			document.getElementsByName(name)[0].value = value
		}

		function getStringDate(date, withDays = true) {
			let month = '' + (date.getMonth() + 1);
			let day = '' + date.getDate();
			if (date.getMonth() < 10) {
				month = "0" + month;
			}
			if (date.getDate() < 10) {
				day = "0" + day;
			}
			if (withDays) {
				return date.getFullYear() + '-' + month + '-' + day;
			} else {
				return date.getFullYear() + '-' + month;
			}
		}

		function getDateFromStringDate(stringDate, withDays = true) {
			if (withDays) {
				return new Date(`${stringDate}T00:00:00`)
			} else {
				return new Date(`${stringDate}-01T00:00:00`)
			}
		}

		let dateTypeMap = {
			0: "Первая смена",
			1: "Вторая смена",
			2: "Со второй смены",
			3: "Выходной"
		}

		let dateTypeClassNameMap = {
			0: "first-shift",
			1: "second-shift",
			2: "after-second-shift",
			3: "weekend"
		}

		let startDateInput = document.getElementsByName("start_date")[0];
		let dateTypeInput = document.getElementsByName("date_type")[0];
		let targetDateInput = document.getElementsByName("target_date")[0];
		let targetDateType = document.getElementById("target_date_type");

		let currentDate = new Date();
		let currentDateFormatted = getStringDate(currentDate);
		
		// Опорная дата в прошлом (известная смена)
		startDateInput.value = "2024-11-12";

		for (const [dateTypeNumber, dateTypeText] of Object.entries(dateTypeMap)) {
			var dateTypeOption = document.createElement('option');
			dateTypeOption.value = dateTypeNumber;
			dateTypeOption.innerHTML = dateTypeText;
			dateTypeInput.appendChild(dateTypeOption);
		}

		function getTargetDateType(startDate, targetDate, startDateTypeNumber) {
			let daysNumberBetweenDates = Math.floor(((targetDate - startDate) / 86400000));
			let targetDateTypeNumber;
			if (daysNumberBetweenDates >= 0) {
				targetDateTypeNumber = (daysNumberBetweenDates + startDateTypeNumber) % 4;
			} else {
				targetDateTypeNumber = Math.abs(4 + daysNumberBetweenDates - startDateTypeNumber) % 4;
			}
			return targetDateTypeNumber;
		}

		function setTargetDateType(startDateInput, startDateTypeInput, targetDateInput, targetDateType) {
			let startDateTypeNumber = Number(startDateTypeInput.value);
			let startDate = getDateFromStringDate(startDateInput.value)
			let targetDate = getDateFromStringDate(targetDateInput.value);
			let targetDateTypeNumber = getTargetDateType(startDate, targetDate, startDateTypeNumber);
			targetDateType.innerText = dateTypeMap[targetDateTypeNumber];
		}

		let startCalendarDateInput = document.getElementsByName("start_calendar_date")[0];
		let endCalendarDateInput = document.getElementsByName("end_calendar_date")[0];
		
		// Календарь начинается с текущего месяца
		startCalendarDateInput.value = getStringDate(currentDate, withDays = false);
		
		// И показывает следующие 2 месяца
		let endDate = new Date(currentDate);
		endDate.setMonth(endDate.getMonth() + 2);
		endCalendarDateInput.value = getStringDate(endDate, withDays = false);

		let jsMonthMap = {
			0: "Январь",
			1: "Февраль",
			2: "Март",
			3: "Апрель",
			4: "Май",
			5: "Июнь",
			6: "Июль",
			7: "Август",
			8: "Сентябрь",
			9: "Октябрь",
			10: "Ноябрь",
			11: "Декабрь"
		}

		function getWeekDay(date) {
			return (date.getDay() + 6) % 7 + 1;
		}

		function getStyledMonthDays(date, startDate, startDateTypeNumber) {
			let dateType = getTargetDateType(startDate, date, startDateTypeNumber);
			let lastDateOfMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0);
			let firstMonthWeekDay = getWeekDay(date);
			let lastMonthWeekDay = getWeekDay(lastDateOfMonth);

			let monthDays = Array(firstMonthWeekDay - 1).fill('');
			for (let monthDay = 1; monthDay <= lastDateOfMonth.getDate(); monthDay++) {
				let dayDate = new Date(date.getFullYear(), date.getMonth(), monthDay);
				dateType = getTargetDateType(startDate, dayDate, startDateTypeNumber);
				
				// Проверяем, является ли это текущим днем
				let isCurrentDay = dayDate.getFullYear() === currentDate.getFullYear() &&
								   dayDate.getMonth() === currentDate.getMonth() &&
								   dayDate.getDate() === currentDate.getDate();
				
				let className = dateTypeClassNameMap[dateType];
				if (isCurrentDay) {
					className += ' current-day';
				}
				
				monthDays.push({value: monthDay, className: className});
			}
			monthDays = monthDays.concat(Array(7 - lastMonthWeekDay).fill(''));
			return monthDays;
		}

		function getMonthHeadHTML(year, monthName) {
			let tableHeadDOMElement = document.createElement("thead");
			tableHeadDOMElement.innerHTML = `<tr>
						<th colspan="7">${year} ${monthName}</th>
					</tr>
					<tr>
						<th>Пн</th>
						<th>Вт</th>
						<th>Ср</th>
						<th>Чт</th>
						<th>Пт</th>
						<th>Сб</th>
						<th>Вс</th>
					</tr>`;
			return tableHeadDOMElement;
		}

		function getMonthBodyHTML(monthDays) {
			let tBodyDOMElement = document.createElement("tbody");
			let trDOMElement = document.createElement("tr");
			for (let i = 0; i < monthDays.length; i++) {
				let tdDOMElement = document.createElement('td')
				tdDOMElement.textContent = monthDays[i].value;
				tdDOMElement.className = monthDays[i].className;
				if (i % 7 === 0 && i != 0) {
					tBodyDOMElement.appendChild(trDOMElement);
					trDOMElement = document.createElement("tr");
				}
				trDOMElement.appendChild(tdDOMElement);
			}
			tBodyDOMElement.appendChild(trDOMElement);
			return tBodyDOMElement;
		}

		function getMonthHTML(year, monthName, monthDays) {
			let tableDOMElement = document.createElement('table');
			tableDOMElement.className = "month";
			tableDOMElement.appendChild(getMonthHeadHTML(year, monthName));
			tableDOMElement.appendChild(getMonthBodyHTML(monthDays));
			return tableDOMElement;
		}

		function drawMonth(date, startDate, startDateTypeNumber) {
			let styledMonthDays = getStyledMonthDays(date, startDate, startDateTypeNumber);
			
			let monthDOMElement = getMonthHTML(date.getFullYear(), 
										 jsMonthMap[date.getMonth()],
										 styledMonthDays);
			document.getElementById("calendar").appendChild(monthDOMElement);
		}

		function clearCalendar(calendar) {
			calendar.innerHTML = '';
		}

		function buildCalendar(startCalendarDateInput, endCalendarDateInput, startDateInput, dateTypeInput) {
			let calendar = document.getElementById("calendar");
			clearCalendar(calendar);

			let startCalendarDate = getDateFromStringDate(startCalendarDateInput.value, withDays=false);
			let endCalendarDate = getDateFromStringDate(endCalendarDateInput.value, withDays=false);
			let startDate = getDateFromStringDate(startDateInput.value);
			let startDateType = Number(dateTypeInput.value);

			let nextCalendarDate = startCalendarDate;
			let boundCalendarDate = endCalendarDate;
			if (startCalendarDate > endCalendarDate) {
				nextCalendarDate = endCalendarDate;
				boundCalendarDate = startCalendarDate;
			}
			while (nextCalendarDate <= boundCalendarDate) {
				drawMonth(nextCalendarDate, startDate, startDateType);
				nextCalendarDate.setMonth(nextCalendarDate.getMonth() + 1);
			}
		}

		function drawDateTypeColorMap() {
			let colorMapHTMLElement = document.createElement('div');
			for (let i = 0; i <= 3; i++) {
				let colorHTMLElement = document.createElement('div')
				colorHTMLElement.textContent = dateTypeMap[i];
				colorHTMLElement.className = dateTypeClassNameMap[i] + " color_map_item";
				colorMapHTMLElement.appendChild(colorHTMLElement);
			}
			document.getElementById('color_map').appendChild(colorMapHTMLElement);
		}

		drawDateTypeColorMap();
		buildCalendar(startCalendarDateInput, endCalendarDateInput, startDateInput, dateTypeInput);
		
		startDateInput.oninput = () => {
			if (targetDateInput.value) {
				setTargetDateType(startDateInput, dateTypeInput, targetDateInput, targetDateType);
			}
			buildCalendar(startCalendarDateInput, endCalendarDateInput, startDateInput, dateTypeInput);
		};
		
		dateTypeInput.oninput = () => {
			if (targetDateInput.value) {
				setTargetDateType(startDateInput, dateTypeInput, targetDateInput, targetDateType);
			}
			buildCalendar(startCalendarDateInput, endCalendarDateInput, startDateInput, dateTypeInput);
		};
		
		targetDateInput.oninput = () => {
			setTargetDateType(startDateInput, dateTypeInput, targetDateInput, targetDateType);
		};
		
		startCalendarDateInput.oninput = () => {
			buildCalendar(startCalendarDateInput, endCalendarDateInput, startDateInput, dateTypeInput);
		};
		
		endCalendarDateInput.oninput = () => {
			buildCalendar(startCalendarDateInput, endCalendarDateInput, startDateInput, dateTypeInput);
		};
	</script>
</body>
</html>